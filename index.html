<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Microbule by jwcarman</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Microbule</h1>
      <h2 class="project-tagline">Making Microservices Fun and Easy!</h2>
      <a href="https://github.com/jwcarman/microbule" class="btn">View on GitHub</a>
      <a href="https://github.com/jwcarman/microbule/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/jwcarman/microbule/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="microbule" class="anchor" href="#microbule" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Microbule</h1>

<p>Microbule provides a framework for developing <a href="http://www.martinfowler.com/articles/microservices.html">Microservices</a>
quickly and easily!  Services are written using the standard
 <a href="https://jax-rs-spec.java.net/">Java API for RESTful Services</a> (JAX-RS).</p>

<h2>
<a id="getting-started" class="anchor" href="#getting-started" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Getting Started</h2>

<p>Microbule is an extension of the <a href="http://karaf.apache.org">Apache Karaf</a> container.  Getting started with Microbule is
 simple:</p>

<ol>
<li>
<a href="http://karaf.apache.org/download.html">Download</a> Apache Karaf (version 4.0.x) and extract to [KARAF_HOME].</li>
<li>
<p>Start Apache Karaf:</p>

<pre><code>cd [KARAF_HOME]
bin/karaf
</code></pre>
</li>
<li>
<p>Install the Microbule Karaf <a href="https://karaf.apache.org/manual/latest/provisioning">Feature</a>:</p>

<pre><code>       __ __                  ____
      / //_/____ __________ _/ __/
     / ,&lt;  / __ `/ ___/ __ `/ /_
    / /| |/ /_/ / /  / /_/ / __/
   /_/ |_|\__,_/_/   \__,_/_/

Apache Karaf (4.0.7)

Hit '&lt;tab&gt;' for a list of available commands
and '[cmd] --help' for help on a specific command.
Hit '&lt;ctrl-d&gt;' or type 'system:shutdown' or 'logout' to shutdown Karaf.

karaf@root()&gt; repo-add mvn:org.microbule/microbule-features/&lt;VERSION&gt;/xml/features
karaf@root()&gt; feature:install microbule
</code></pre>
</li>
<li>
<p>Install The Microbule Examples</p>

<pre><code>karaf@root()&gt; feature:install microbule-examples
</code></pre>
</li>
<li><p>Enjoy!</p></li>
</ol>

<h2>
<a id="writing-your-own-services" class="anchor" href="#writing-your-own-services" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Writing Your Own Services</h2>

<p>Microbule uses the OSGi <a href="http://enroute.osgi.org/doc/218-patterns.html">Whiteboard Pattern</a> to discover JAX-RS services
at runtime.  In order to register a service with Microbule, you have to expose them as an OSGi service with the
"microbule.address" service property.  Microbule provides the following BundleActivator-based example:</p>

<pre><code>public class HelloActivator implements BundleActivator {

    private ServiceRegistration&lt;HelloResource&gt; registration;

    @Override
    public void start(BundleContext context) throws Exception {
        Dictionary&lt;String,Object&gt; props = new Hashtable&lt;&gt;();
        props.put("microbule.address", "/microbule-example-activator");
        registration = context.registerService(HelloResource.class, new DefaultHelloResource(), props);
    }

    @Override
    public void stop(BundleContext context) throws Exception {
        registration.unregister();
    }
}

</code></pre>

<p>Microbule will automatically detect the service set its publish address as "/microbule-example-activator" using
<a href="http://cxf.apache.org">Apache CXF</a> as the JAX-RS implementation.  Since Microbule uses OSGi services, you can use your
framework-of-choice (OSGi Blueprint, OSGi Declarative Services, CDI, etc.) to wire up your service implementation object.
The service <em>interface</em> should be annotated with all of the appropriate JAX-RS annotations.</p>

<h2>
<a id="microbule-features" class="anchor" href="#microbule-features" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Microbule Features</h2>

<p>Microbule provides many built-in features out-of-the-box.</p>

<h3>
<a id="gson" class="anchor" href="#gson" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>GSON</h3>

<p>Microbule will transform payloads to/from JSON using the <a href="https://github.com/google/gson">Google GSON</a> library.  For
example, given the following response type:</p>

<pre><code>public class HelloResponse {

    private final String greeting;

    public HelloResponse(String greeting) {
        this.greeting = greeting;
    }

    public String getGreeting() {
        return greeting;
    }
}
</code></pre>

<p>Microbule will automatically format the response paylad as:</p>

<pre><code>{
  "greeting": "Hello, Microbule!"
}
</code></pre>

<h3>
<a id="request-logging" class="anchor" href="#request-logging" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Request Logging</h3>

<p>Microbule will log begin/end events for every service call:</p>

<pre><code> 2016-11-21 10:57:01,568  INFO RequestLogFilter - BEGIN GET hello/Microbule
 2016-11-21 10:57:01,583  INFO RequestLogFilter - END   GET hello/Microbule - 200 OK (0.012 sec)
</code></pre>

<h3>
<a id="bean-validation-jsr-303" class="anchor" href="#bean-validation-jsr-303" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Bean Validation (<a href="https://jcp.org/en/jsr/detail?id=303">JSR-303</a>)</h3>

<p>Microbule can automatically validate method parameters using Bean Validation:</p>

<pre><code> @Path("/")
 public interface HelloResource {

     @Path("/hello/{name}")
     @Produces(MediaType.APPLICATION_JSON)
     @GET
     @Cacheable
     HelloResponse sayHello(@PathParam("name") @Size(min = 5, message="Name must be at least 5 characters long.") String name);
 }
</code></pre>

<h3>
<a id="cross-origin-resource-scripting-cors" class="anchor" href="#cross-origin-resource-scripting-cors" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Cross-Origin Resource Scripting (CORS)</h3>

<p>Microbule automatically adds CORS headers to your responses.</p>

<h3>
<a id="tracer" class="anchor" href="#tracer" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Tracer</h3>

<p>Microbule will generate a the following random UUID header values automatically:</p>

<ul>
<li>
<strong>Microbule-Trace-ID</strong>: a unique value corresponding to a "transaction."  If the header is found on the request, the
existing value will be used.</li>
<li>
<strong>Microbule-Request-ID</strong>: a unique value corresponding to the request itself.  This is generated for each and every
request.</li>
</ul>

<p>A typical response will contain the following headers:</p>

<pre><code> Microbule-Request-ID=[3a5bf571-99fd-4c6b-b79e-7ff0a28e9350]
 Microbule-Trace-ID=[da3e59f4-8aff-4a89-bc30-7ad310fecf63]
</code></pre>

<h3>
<a id="cache-control-header" class="anchor" href="#cache-control-header" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Cache-Control Header</h3>

<p>Microbule will automatically manage the <em>Cache-Control</em> headers for you.  Each method annotated with @Cacheable will
yield a <em>Cache-Control</em> header.  For example, consider the following method:</p>

<pre><code> @GET
 @Produces(MediaType.TEXT_PLAIN)
 @Path("/value")
 @Cacheable(maxAge = 600)
 String getValue();
</code></pre>

<p>When executed, the <em>Cache-Control</em> header will contain:</p>

<pre><code> Cache-Control=[no-transform,max-age=600]
</code></pre>

<p>Microbule will also manage the <em>ETag</em> and <em>Last-Modified</em> headers for you.  You can provide these values by using a
JAX-RS Response object:</p>

<pre><code> public Response createResponse() {
   return Response.ok("payload").lastModified(new Date()).build();
 }
</code></pre>

<p>or by injecting a <em>ResourceState</em> object, using the <a href="https://github.com/Context" class="user-mention">@Context</a> annotation:</p>

<pre><code>  public class CacheResourceImpl implements CacheResource {

      @Context
      private ResourceState resourceState;

      @Override
      public String getValueWithEtag() {
          resourceState.setEntityTag("12345");
          return "payload";
      }
  }
</code></pre>

<p>When an <em>ETag</em> or <em>Last-Modified</em> value is provided, Microbule will check the <em>If-None-Match</em> and <em>If-Modified-Since</em>
headers correspondingly.  If the resource is up-to-date, Microbule will return a "No Content" (204) response.</p>

<h3>
<a id="circuit-breaker" class="anchor" href="#circuit-breaker" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Circuit Breaker</h3>

<p>All client proxies generated by Microbule will include a
<a href="http://martinfowler.com/bliki/CircuitBreaker.html">Circuit Breaker</a> to avoid overloading services when they are
encountering issues.  By default, the circuit breaker will "open" when the service responds with more than <em>10</em> server
error level (500+) responses per second and will "close" when it drops back down below this threshold.</p>

<h3>
<a id="error-mapping" class="anchor" href="#error-mapping" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Error Mapping</h3>

<p>Microbule will inject its own JAX-RS ExceptionMappers into the services by default.  These ExceptionMappers will use
the ErrorMapperService to create responses when an exception happens.  The default format of the error response will be
a plain text response with newline-separated error messages.  You can override the default format by exposing an
ErrorResponseStrategy OSGi service.  To provide mapping for individual exception types, simply expose an ErrorMapper
OSGi service.</p>

<h2>
<a id="creating-client-proxies" class="anchor" href="#creating-client-proxies" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Creating Client Proxies</h2>

<p>One of the beautiful features of Apache CXF is its ability to generate dynamic client proxies that implement the JAX-RS
service interface.  Microbule uses this feature to provide type-safe client proxies:</p>

<pre><code> JaxrsProxyFactory proxyFactory = ...;
 Map&lt;String,Object&gt; props = new HashMap&lt;&gt;();
 props.put("microbule.circuitbreaker.enabled", "false");
 HelloService helloService = proxyFactory.createProxy(HelloService.class, "http://localhost:8383/HelloService", props);
</code></pre>

<p>Microbule exposes a JaxrsProxyFactory OSGi service for you to use.  Simply inject it wherever you need to create client
proxies.</p>

<h2>
<a id="opting-out" class="anchor" href="#opting-out" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Opting Out</h2>

<p>By default, Microbule will apply all registered decorators to your services/proxies.  However, you can opt out of them
individually using a service property.  For example, if you want to provide your own JSON processing provider, you can
disable the GSON-based provider by setting the following service property:</p>

<pre><code> microbule.gson.enabled=false
</code></pre>

<h2>
<a id="whats-in-a-name" class="anchor" href="#whats-in-a-name" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>What's in a Name?</h2>

<p>A "microbule" is a unit of length used in Marvel's
<a href="http://marvel.com/characters/70/guardians_of_the_galaxy">Guardians of the Galaxy</a> movie.  Microbule strives to be the
microservices framework that the others will try to measure up to!</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/jwcarman/microbule">Microbule</a> is maintained by <a href="https://github.com/jwcarman">jwcarman</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
